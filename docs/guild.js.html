<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: guild.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: guild.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module guild
 */
 
 /**
 * Discord.js Client object
 * @external Client
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/Client}
 */
 
 /**
 * Discord.js Guild object
 * @external Guild
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/Guild}
 */
 
 /**
 * Discord.js Category object
 * @external CategoryChannel
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/CategoryChannel}
 */
 
 /**
 * Discord.js Channel object
 * @external GuildChannel
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/GuildChannel}
 */
 
 /**
 * Discord.js Role object
 * @external Role
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/Role}
 */
 
 /**
 * Discord.js GuildMember object
 * @external GuildMember
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/GuildMember}
 */
 
 /**
 * Discord.js User object
 * @external User
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/User}
 */
 
 /**
 * Discord.js Message object
 * @external Message
 * @see {@link https://discord.js.org/#/docs/main/11.3.2/class/Message}
 */
 
const logger = require('./logger');
const {
    findUserBySteamId64,
} = require('./db');

const findOrCreateCategory = async (guild, categoryName) => {
    let category = guild.channels.filter(guildChannel => guildChannel.type === 'category' &amp;&amp; guildChannel.name === categoryName).first();
    if (category) {
        logger.debug(`Category exists. ${categoryName}`);
    }
    else {
        category = await guild.createChannel(categoryName, 'category');
        logger.debug(`Category created. ${categoryName}`);
    }
    return category;
};

const findOrCreateChannelInCategory = async (guild, category, channelName) => {
    const _channelName = channelName.toLowerCase();
    let channel = guild.channels.filter(_channel => _channel.name === _channelName &amp;&amp; _channel.parentID === category.id).first();
    if (channel) {
        logger.debug(`Channel exists. ${_channelName}`);
    }
    else {
        channel = await guild.createChannel(_channelName, 'text');
        logger.debug(`Channel created. ${_channelName}`);
    }
    await channel.setParent(category);
    return channel;
};

const findOrCreateRole = async (guild, roleName) => {
    let role = guild.roles.find('name', roleName);
    if (role) {
        logger.debug(`Role exists. ${roleName}`);
    }
    else {
        role = await guild.createRole({ name: roleName });
        logger.debug(`Role created. ${roleName}`);
    }
    return role;
};

const resolveUser = async (guild, userResolvable) => {
    logger.debug(`resolveUser ${userResolvable} ${typeof userResolvable}`);
    if (userResolvable !== null &amp;&amp; typeof userResolvable === 'object') {
        if ('discord_id' in userResolvable) {
            return guild.members.get(userResolvable.discord_id);
        }
        if ('steamid_64' in userResolvable) {
            const user = await findUserBySteamId64(guild.id)(userResolvable.steamid_64);
            return guild.members.get(user.discord_id);
        }
    }
    else if (typeof userResolvable === 'string') {
        return guild.members.get(userResolvable);
    }
    return null;
};

const resolveRole = (guild, roleResolvable) => ((typeof roleResolvable === 'string') ? guild.roles.find('name', roleResolvable) : roleResolvable);

const addRoleToUser = guild => roleResolvable => async (userResolvable) => {
    const [role, user] = await Promise.all([
        resolveRole(guild, roleResolvable),
        resolveUser(guild, userResolvable),
    ]);
    if (!role) logger.debug(`addRoleToUser role not found ${roleResolvable}`);
    if (!user) logger.debug(`addRoleToUser user not found ${userResolvable}`);
    if (role &amp;&amp; user) {
        logger.debug(`addRoleToUser ${role.name} ${user.displayName}`);
        return user.addRole(role);
    }
    return null;
};

module.exports = {
    findOrCreateCategory,
    findOrCreateChannelInCategory,
    findOrCreateRole,
    resolveUser,
    resolveRole,
    addRoleToUser,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-client.html">client</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-db.html">db</a></li><li><a href="module-dotaBot.html">dotaBot</a></li><li><a href="module-guild.html">guild</a></li><li><a href="module-ihl.html">ihl</a></li><li><a href="module-ihlManager.html">ihlManager</a></li><li><a href="module-lobby.html">lobby</a></li><li><a href="module-matchTracker.html">matchTracker</a></li></ul><h3>Externals</h3><ul><li><a href="external-CategoryChannel.html">CategoryChannel</a></li><li><a href="external-Client.html">Client</a></li><li><a href="external-EventEmitter.html">EventEmitter</a></li><li><a href="external-Guild.html">Guild</a></li><li><a href="external-GuildChannel.html">GuildChannel</a></li><li><a href="external-GuildMember.html">GuildMember</a></li><li><a href="external-Message.html">Message</a></li><li><a href="external-Model.html">Model</a></li><li><a href="external-Role.html">Role</a></li><li><a href="external-User.html">User</a></li></ul><h3>Classes</h3><ul><li><a href="module-dotaBot-DotaBot.html">DotaBot</a></li><li><a href="module-ihlManager-IHLManager.html">IHLManager</a></li><li><a href="module-matchTracker-MatchTracker.html">MatchTracker</a></li><li><a href="Queue.html">Queue</a></li></ul><h3>Events</h3><ul><li><a href="module-ihlManager.html#~event:EVENT_MATCH_ENDED">EVENT_MATCH_ENDED</a></li><li><a href="module-ihlManager.html#~event:EVENT_PICK_PLAYER">EVENT_PICK_PLAYER</a></li><li><a href="module-ihlManager.html#~event:EVENT_PLAYER_READY">EVENT_PLAYER_READY</a></li><li><a href="module-ihlManager.html#~event:EVENT_PLAYERS_READY">EVENT_PLAYERS_READY</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jul 19 2018 13:39:08 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
